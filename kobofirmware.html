<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Kobo Firmware Download Links</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Direct links to download Kobo firmware for all Kobo eReader devices including the Kobo Mini, Kobo Touch, Kobo Glo, Kobo Aura, and more.">
    <meta name="author" content="Patrick G">
</head>

<body>
    <h1>Kobo Firmware Download Links</h1>
    <p>This tool will get the latest official firmware links directly from Kobo.</p>
    <p><b>How to use these links: </b> After you download the correct link for your firmware, extract the zip file into the <tt>.kobo</tt> folder of your Kobo eReader</p>
    <table id="KoboFirmware">
        <tr>
            <th>Model</th>
            <th>Firmware Version</th>
            <th>Firmware Link</th>
        </tr>
    </table>
    <footer>
        A tool provided by <a href="//github.com/geek1011">geek1011</a>. If you liked this tool, you might like <a href="http://geek1011.github.io/BookReader">BookReader</a>.
    </footer>
    <style>
        body {
            max-width: 600px;
            margin: auto;
            font-family: sans-serif;
        }

        h1 {
            text-align: center;
            font-weight: 300;
        }

        p {
            text-align: justify;
        }

        footer {
            text-align: center;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            border: 1px solid #ddd;
        }
        
        th,
        td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        tr:hover {
            background-color: #f5f5f5
        }
    </style>
    <script>
        var jsonp = function (src, options) {
            var callback_name = options.callbackName || 'callback',
                on_success = options.onSuccess || function () {},
                on_timeout = options.onTimeout || function () {},
                timeout = options.timeout || 10; // sec

            var timeout_trigger = window.setTimeout(function () {
                window[callback_name] = function () {};
                on_timeout();
            }, timeout * 1000);

            window[callback_name] = function (data) {
                window.clearTimeout(timeout_trigger);
                on_success(data);
            };

            var script = document.createElement('script');
            script.type = 'text/javascript';
            script.async = true;
            script.src = src;

            document.getElementsByTagName('head')[0].appendChild(script);
        };

        var versionCompare = function (v1, v2) {
            var v1parts = v1.split('.');
            var v2parts = v2.split('.');

            function isValidPart(x) {
                return (/^\d+$/).test(x);
            }

            if (!v1parts.every(isValidPart) || !v2parts.every(isValidPart)) {
                return NaN;
            }

            v1parts = v1parts.map(Number);
            v2parts = v2parts.map(Number);

            for (var i = 0; i < v1parts.length; ++i) {
                if (v2parts.length == i) {
                    return 1;
                }

                if (v1parts[i] == v2parts[i]) {
                    continue;
                } else if (v1parts[i] > v2parts[i]) {
                    return 1;
                } else {
                    return -1;
                }
            }

            if (v1parts.length != v2parts.length) {
                return -1;
            }

            return 0;
        };

        var KoboFirmware = {};
        KoboFirmware.callbacks = {};

        KoboFirmware.models = {
            "00000000-0000-0000-0000-000000000310": "Kobo Touch A/B",
            "00000000-0000-0000-0000-000000000320": "Kobo Touch C",
            "00000000-0000-0000-0000-000000000340": "Kobo Mini",
            "00000000-0000-0000-0000-000000000330": "Kobo Glo",
            "00000000-0000-0000-0000-000000000371": "Kobo Glo HD",
            "00000000-0000-0000-0000-000000000372": "Kobo Touch 2.0",
            "00000000-0000-0000-0000-000000000360": "Kobo Aura",
            "00000000-0000-0000-0000-000000000350": "Kobo Aura HD",
            "00000000-0000-0000-0000-000000000370": "Kobo Aura H2O",
            "00000000-0000-0000-0000-000000000373": "Kobo Aura ONE",
            "00000000-0000-0000-0000-000000000375": "Kobo Aura Edition 2"
        };

        KoboFirmware.affiliates = {
            "kobo": "Kobo",
            "bestbuyus": "Best Buy US",
            "bestbuyca": "Best Buy CA",
            "walmartus": "Walmart US",
            "walmartca": "Walmart CA",
            "indigo": "Indigo",
            "whsmith": "WHSmith",
            "fnac": "Fnac",
            "mondadori": "Mondadori",
            "livrariacultura": "Livraria Cultura",
            "lacentral": "La Central",
            "librisblz": "Libris BLZ",
            "rakutenbooks": "Rakuten"
        };

        KoboFirmware.GetUpdateInfo = function (model, affiliate, callback) {
            var callbackName = (function () {
                var text = "";
                var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";

                for (var i = 0; i < 20; i++)
                    text += possible.charAt(Math.floor(Math.random() * possible.length));

                return text;
            })();

            var result = {
                "model": null,
                "modelName": null,
                "affiliate": null,
                "releaseDate": null,
                "firmwareVersion": null,
                "updateURL": null,
                "releaseNotesURL": null,
                "error": null
            };

            if (!KoboFirmware.models[model]) {
                result.error = true;
                callback("No such model", result);
                return;
            }
            result.model = model;
            result.modelName = KoboFirmware.models[model];

            if (!KoboFirmware.affiliates[affiliate]) {
                result.error = true;
                callback("No such affiliate", result);
                return;
            }
            result.affiliate = affiliate;

            jsonp("https://json2jsonp.com/?url=https://api.kobobooks.com/1.0/UpgradeCheck/Device/" + model +
                "/" + affiliate + "/0.0/N&callback=" + callbackName, {
                    "callbackName": callbackName,
                    "onSuccess": function (json) {
                        if (json.UpgradeURL) {
                            result.releaseDate = json.UpgradeURL.split("/")[5];
                            result.firmwareVersion = json.UpgradeURL.replace('kobo-update-', '').replace(
                                '.zip', '').split('/').pop();
                            result.updateURL = json.UpgradeURL;
                            result.releaseNotesURL = json.ReleaseNoteURL;
                            result.error = false;
                            callback(null, result);
                        } else {
                            result.error = true;
                            callback("Invalid response returned", result);
                        }
                    },
                    "timeout": 2.5,
                    "onTimeout": function () {
                        result.error = true;
                        callback("Connection timed out", result);
                    }
                }
            );
        };

        KoboFirmware.table = document.getElementById("KoboFirmware");

        KoboFirmware.LoadUpdates = function () {
            for (var i in KoboFirmware.models) {
                if (KoboFirmware.models.hasOwnProperty(i)) {
                    var row = document.createElement("tr");
                    row.id = i;
                    var modelNameCol = document.createElement("td");
                    modelNameCol.className = "modelName";
                    row.appendChild(modelNameCol);
                    var firmwareVersionCol = document.createElement("td");
                    firmwareVersionCol.className = "firmwareVersion";
                    firmwareVersionCol.innerHTML = "loading";
                    row.appendChild(firmwareVersionCol);
                    var downloadLinkCol = document.createElement("td");
                    downloadLinkCol.className = "downloadLink";
                    row.appendChild(downloadLinkCol);
                    KoboFirmware.table.appendChild(row);

                    (function (model) {
                        KoboFirmware.GetUpdateInfo(model, "kobo", function (errA, resultA) {
                            KoboFirmware.GetUpdateInfo(model, "rakutenbooks", function (
                                errB, resultB) {
                                var result = resultA;
                                try {
                                    if (versionCompare(resultA.firmwareVersion, resultB.firmwareVersion) >=
                                        0) {
                                        result = resultA;
                                    } else {
                                        result = resultB;
                                    }
                                } catch (e) {}

                                var row = document.getElementById(result.model);

                                row.getElementsByClassName("modelName")[0].innerHTML = result.modelName;
                                
                                if (errA || errB) {
                                    row.getElementsByClassName("firmwareVersion")[0].innerHTML =
                                        errA || errB;
                                } else {
                                    row.getElementsByClassName("firmwareVersion")[0].innerHTML =
                                        result.firmwareVersion + " - " + result.releaseDate;
                                }

                                if (errA || errB) {
                                    row.getElementsByClassName("downloadLink")[0].innerHTML =
                                        "";
                                } else {
                                    var a = document.createElement("a");
                                    a.href = result.updateURL;
                                    a.innerHTML = "Download";
                                    row.getElementsByClassName("downloadLink")[0].appendChild(a);
                                }
                            });
                        });
                    })(i);
                }
            }
        };

        KoboFirmware.LoadUpdates();
    </script>
</body>

</html>
